# bnminer

External Blocknet miner with a pluggable backend architecture.

Current status:
- CPU backend: implemented (Argon2id, consensus-compatible params).
- NVIDIA backend: scaffolded interface only (not implemented yet).

## Test

```bash
cd bnminer
cargo test
```

## Build

```bash
cd bnminer
cargo build --release
```

## Run

`bnminer` needs the authenticated API token generated by `blocknet --api`.

If your daemon data dir is `./data` (default), this works out of the box:

```bash
./target/release/bnminer --api-url http://127.0.0.1:8332 --threads 1
```

If your cookie file is elsewhere:

```bash
./target/release/bnminer --api-url http://127.0.0.1:8332 --cookie /path/to/data/api.cookie
```

Or pass token directly:

```bash
./target/release/bnminer --api-url http://127.0.0.1:8332 --token <hex_token>
```

## Notes

- Each CPU thread needs roughly 2GB RAM due to Argon2id parameters.
- The miner fetches block templates from `/api/mining/blocktemplate` and submits solved blocks to `/api/mining/submitblock`.
- This miner is intentionally external so consensus-critical validation remains in the daemon.

## Performance Benchmarking

Run deterministic local benchmarking (no API connection needed):

```bash
cd bnminer
cargo run --release -- --bench --backend cpu --threads 1 --bench-secs 20 --bench-rounds 3 --bench-output bench.json
```

Compare against a previous baseline:

```bash
cargo run --release -- --bench --backend cpu --threads 1 --bench-secs 20 --bench-rounds 3 --bench-baseline bench.json
```
